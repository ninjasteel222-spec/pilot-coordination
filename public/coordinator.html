<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Координатор</title>
  <style>
    body { margin:0; background:#003b6d; }
    #map { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); }
    .marker { position:absolute; width:10px; height:10px; border-radius:50%; }
    #panel { position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.6); color:#fff; padding:10px; }
  </style>
</head>
<body>
  <div id="map"><img src="map.jpg" alt="map"></div>
  <div id="panel"><h3>Пилоты</h3><div id="pilotList"></div></div>

  <script>
    const socket = new WebSocket(
      (location.protocol === "https:" ? "wss://" : "ws://") + location.host
    );
    const map = document.getElementById("map");
    const pilotList = document.getElementById("pilotList");
    const markers = {};

    function updatePanel(pilots) {
      pilotList.innerHTML = "";
      for (const id in pilots) {
        const p = pilots[id];
        const div = document.createElement("div");
        div.textContent = `${p.name} (${id}) ${p.verified ? "✅" : "❌"}`;
        const v = document.createElement("button");
        v.textContent = "Вериф."; v.onclick = () => socket.send(JSON.stringify({type:"verify",pilotId:id}));
        const d = document.createElement("button");
        d.textContent = "Откл."; d.onclick = () => socket.send(JSON.stringify({type:"disconnect",pilotId:id}));
        div.appendChild(v); div.appendChild(d);
        pilotList.appendChild(div);
      }
    }

    socket.onmessage = e => {
      const data = JSON.parse(e.data);
      if (data.type === "pilots") {
        updatePanel(data.pilots);
        for (const id in data.pilots) {
          const p = data.pilots[id];
          if (!markers[id]) {
            const m = document.createElement("div");
            m.className="marker";
            m.style.left=p.x+"px"; m.style.top=p.y+"px";
            m.style.background=p.color||"yellow";
            map.appendChild(m);
            markers[id]=m;
          }
        }
      }
    };

    socket.onopen = () => {
      socket.send(JSON.stringify({type:"register",pilotId:"coordinator",name:"Координатор",isCoordinator:true}));
    };
  </script>
</body>
</html>
