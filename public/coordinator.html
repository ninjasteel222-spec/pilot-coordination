<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Пилот</title>
  <style>
    body { margin:0; background:#003b6d; }
    #map { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); }
    .marker { position:absolute; width:10px; height:10px; border-radius:50%; }
    #panel { position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.6); color:#fff; padding:10px; }
  </style>
</head>
<body>
  <div id="map"><img src="map.jpg" alt="map"></div>
  <div id="panel"><h3>Пилот</h3><div id="pilotInfo"></div></div>

  <script>
    let pilotId = localStorage.getItem("pilotId");
    let name = localStorage.getItem("pilotName");
    let color = localStorage.getItem("pilotColor");

    if (!pilotId || !name) {
      pilotId = "pilot-" + Math.floor(Math.random()*10000);
      name = prompt("Введите ваше имя:");
      color = `hsl(${Math.floor(Math.random()*360)},80%,50%)`;
      localStorage.setItem("pilotId",pilotId);
      localStorage.setItem("pilotName",name);
      localStorage.setItem("pilotColor",color);
    }

    const socket = new WebSocket(
      (location.protocol === "https:" ? "wss://" : "ws://") + location.host
    );
    const map = document.getElementById("map");
    const pilotInfo = document.getElementById("pilotInfo");
    let marker;

    function updateInfo(x,y,verified) {
      pilotInfo.innerHTML=`ID:${pilotId}<br>Имя:${name}<br>(${x},${y})<br>${verified?"✅":"❌"}`;
    }

    socket.onopen = () => {
      socket.send(JSON.stringify({type:"register",pilotId,name,color}));
    };

    socket.onmessage = e => {
      const data = JSON.parse(e.data);
      if (data.type==="pilots") {
        const p=data.pilots[pilotId];
        if (p && !marker) {
          marker=document.createElement("div");
          marker.className="marker";
          marker.style.left=p.x+"px"; marker.style.top=p.y+"px";
          marker.style.background=color;
          map.appendChild(marker);
          updateInfo(p.x,p.y,p.verified);
        }
      }
      if (data.type==="verify" && data.pilotId===pilotId) {
        updateInfo(marker.style.left,marker.style.top,true);
      }
      if (data.type==="disconnect" && data.pilotId===pilotId) {
        localStorage.clear();
        alert("Вас отключил координатор");
